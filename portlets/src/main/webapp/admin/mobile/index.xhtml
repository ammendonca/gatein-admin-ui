<ui:composition template="/template.xhtml"
				xmlns="http://www.w3.org/1999/xhtml"
				xmlns:h="http://java.sun.com/jsf/html"
				xmlns:f="http://java.sun.com/jsf/core"
				xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:rich="http://richfaces.org/rich"
				xmlns:a4j="http://richfaces.org/a4j"
				xmlns:b="http://richfaces.org/sandbox/bootstrap"
				xmlns:c="http://java.sun.com/jsp/jstl/core">

	<ui:define name="content">
		<h1><a4j:outputPanel id="siteName"><h:outputText styleClass="gray" value="#{mr.siteName}" /></a4j:outputPanel> Mobile Redirects</h1>
		<a class="btn btn-small pull-right" id="add-redirect">Add Redirect</a>
		<c:set var="redirects" value="${mr.redirects}"/>
		<c:set var="sites" value="${mr.sites}"/>
		<c:choose>
			<c:when test="${redirects.size() == 0}">
				<h2 class="initial">You have not set up any redirects.</h2>
				<p class="initial">Redirect to an alternative site based on the device, browser or user preferences.</p>
				<h:graphicImage class="initial" library="img" name="mobile-redirects.png" alt="Illustration: Arrow pointing from a laptop to a tablet and a smartphone" />
			</c:when>

			<c:otherwise>
				<b:tabbable>
				<c:forEach items="#{redirects}" var="r">
					<b:tab title="#{r.name}">
						<table class="table table-striped">
							<thead id="redirect-summary-header" class="hidden-element injectable">
								<tr>
									<th>Status</th>
									<th>Redirect name</th>
									<th>Configurations</th>
									<th class="actions hidden-element">Actions</th>
								</tr>
							</thead>
							<tbody>
								<!-- Redirect Summary Row -->
								<tr class="yellow hidden-element">
									<td>
										<div class="onoffswitch">
											<h:selectBooleanCheckbox name="onoffswitch-summary" styleClass="onoffswitch-checkbox" id="redirect2" value="#{r.isEnabled()}"/>
											<h:outputLabel for="redirect2" styleClass="onoffswitch-label">
												<span class="onoffswitch-inner">
													<span class="onoffswitch-active">ON</span>
													<span class="onoffswitch-inactive">OFF</span>
												</span>
												<span class="onoffswitch-switch"></span>
											</h:outputLabel>
										</div>
									</td>
									<td>#{r.name}</td>
									<td>Redirect to #{r.redirectSite} <span class="second-info">#{r.conditions.size()} conditions and #{r.mappings.mappings.size()} mappings</span></td>
									<td class="actions">
										<a class="configure-redirect" href="#">Configure</a>
										<button class="tooltipTrigger" title="Delete Redirect"><i class="icon-trash">Delete Redirect</i></button>
									</td>
								</tr>
								<!-- Edit Redirect Row -->
								<tr class="form-mobile-redirect">
									<td colspan="4">
										<h:form styleClass="form-horizontal">
											<fieldset class="header-mobile-redirect">
												<legend class="hidden-element">
													<span>General Settings</span>
												</legend>
												<div class="onoffswitch">
													<h:selectBooleanCheckbox name="onoffswitch" styleClass="onoffswitch-checkbox" id="redirect3" value="#{r.isEnabled()}"/>
													<h:outputLabel for="redirect3" styleClass="onoffswitch-label">
														<span class="onoffswitch-inner">
															<span class="onoffswitch-active">ON</span>
															<span class="onoffswitch-inactive">OFF</span>
														</span>
														<span class="onoffswitch-switch"></span>
													</h:outputLabel>
												</div>
												<div class="control-group">
													<h:outputLabel for="name" styleClass="control-label">Redirect Name</h:outputLabel>
													<div class="controls">
														<b:input scale="medium" id="name" placeholder="Redirect Name" value="${r.name}"/>
													</div>
												</div>
												<div class="control-group">
													<h:outputLabel for="redirect" styleClass="control-label">Redirect to</h:outputLabel>
													<div class="controls">
														<h:selectOneMenu id="redirect" value="#{r.redirectSite}">
															<c:forEach items="#{sites}" var="s">
																<f:selectItem itemValue="#{s.name}" itemLabel="#{s.name}" />
															</c:forEach>
														</h:selectOneMenu>
													</div>
												</div><!-- End .control-group -->
											</fieldset>
											<fieldset>
												<legend>
													<span class="toggle">Conditions</span>
												</legend>
												<div>
													<div class="control-group">
														<div class="controls">
															<a class="btn btn-small inside-table add-condition">Add Condition</a>
															<table class="table table-striped button-small">
																<thead>
																	<tr>
																		<th>Condition Name</th>
																		<th>Settings</th>
																		<th class="hidden-element actions">Actions</th>
																	</tr>
																</thead>
																<tbody class="sortable">
																	<c:forEach items="#{r.conditions}" var="rc">
																	<tr class="ui-state-default">
																		<td>#{rc.name}</td>
																		<td>Contains 
																			<c:forEach items="#{rc.userAgentConditions.contains}" var="rcUACcont" varStatus="counter">
																				<c:if test="${counter.count > 1}">
																				 and 
																				</c:if>
																				'#{rcUACcont}'
																			</c:forEach>
																		</td>
																		<c:forEach items="#{rc.userAgentConditions.doesNotContain}" var="rcUACnotcont">
																			<td>Does not contain '#{rcUACnotcont}'</td>
																		</c:forEach>
																		<td class="actions">
																			<a href="#" class="add-condition">Edit</a>
																			<button class="tooltipTrigger" title="Delete Condition"><i class="icon-trash">Delete Condition</i></button>
																		</td>
																	</tr>
																	</c:forEach>
																</tbody>
															</table>							
														</div>
													</div><!-- End .control-group -->
												</div>
											</fieldset>
											<fieldset>
												<legend>
													<span class="toggle">Node Mappings</span>
												</legend>
												<div>
													<div class="control-group">
														<label for="matching" class="control-label">Matching</label>
														<div class="controls">
															<label class="checkbox">
																<h:selectBooleanCheckbox name="matching" id="matching" value="#{r.mappings.isUseNodeNameMatching()}"/>Use node name matching
																<i class="icon-info-sign icon-gray tooltipRightTrigger" title="Origin Node Name matches Redirect Node Name">Origin Node Name matches Redirect Node Name</i>
															</label>
														</div>
													</div><!-- End .control-group -->
													<div class="control-group">
														<label class="control-label">Mappings</label>
														<div class="controls">
															<a class="btn btn-small inside-table">Add Mapping</a>
															<table class="table table-striped action-button" id="mappings">
																<thead>
																	<tr>
																		<th>Origin Node Name</th>
																		<th>Redirect Node Name</th>
																		<th class="hidden-element actions">Actions</th>
																	</tr>
																</thead>
																<tbody>
																	<tr>
																		<td>
																			<!-- TODO: Add popup with list -->			
																			<b:input scale="medium" placeholder="e.g. homepage" >
																				<b:autocomplete suggestions="#{mr.nodes}" />
																				<f:facet name="append">
																					<b:commandButton styleClass="tooltipTrigger select-node" title="View Node List"><i class="icon-list" ></i></b:commandButton>
																				</f:facet>
																			</b:input>
																		</td>
																		<td>
																			<!-- TODO: Replace by JSF -->
																			<div class="input-append">
																				<input type="text" data-provide="typeahead" data-source="[&quot;Alabama&quot;]" class="input-medium" placeholder="e.g. home_page" /><button type="button" class="btn tooltipTrigger select-node" title="View Node List"><i class="icon-list" >View Node List</i></button>
																			</div>
																		</td>
																		<td class="actions">
																			<a href="#" class="edit-node-mapping tooltipTrigger" title="Delete Node Mapping"><i class="icon-trash">Delete Node Mapping</i></a>
																		</td>
																	</tr>
																	<c:forEach items="#{r.mappings.mappings}" var="m">
																	<tr>
																		<td>#{m.originNode}</td>
																		<td>#{m.redirectNode}</td>
																		<td class="actions">
																			<a href="#" class="link edit-node-mapping">Edit</a>
																			<a href="#" class="edit-node-mapping tooltipTrigger" title="Delete Node Mapping"><i class="icon-trash">Delete Node Mapping</i></a>
																		</td>
																	</tr>
																	</c:forEach>
																	<tr>
																		<td>/sample1</td>
																		<td>/sample_one</td>
																		<td class="actions">
																			<a href="#" class="link edit-node-mapping">Edit</a>
																			<a href="#" class="edit-node-mapping tooltipTrigger" title="Delete Node Mapping"><i class="icon-trash">Delete Node Mapping</i></a>
																		</td>
																	</tr>
																	<tr>
																		<td>/sample2</td>
																		<td>/sample_two</td>
																		<td class="actions">
																			<a href="#" class="link edit-node-mapping">Edit</a>
																			<a href="#" class="edit-node-mapping tooltipTrigger" title="Delete Node Mapping"><i class="icon-trash">Delete Node Mapping</i></a>
																		</td>
																	</tr>
																	<tr class="hidden-element white">
																		<td>
																			<div class="input-append">
																				<input type="text" data-provide="typeahead" data-source="[&quot;Alabama&quot;]" class="input-medium" value="/sitemap" /><button type="button" class="btn tooltipTrigger select-node" title="View Node List"><i class="icon-list" >View Node List</i></button>
																			</div>
																		</td>
																		<td>
																			<div class="input-append">
																				<input type="text" data-provide="typeahead" data-source="[&quot;Alabama&quot;]" class="input-medium" value="/site_map" /><button type="button" class="btn tooltipTrigger select-node" title="View Node List"><i class="icon-list" >View Node List</i></button>
																			</div>
																		</td>
																		<td class="actions">
																			<a href="#" class="edit-node-mapping tooltipTrigger" title="Delete Node Mapping"><i class="icon-trash">Delete Node Mapping</i></a>
																		</td>
																	</tr>
																</tbody>
															</table>							
														</div>
													</div><!-- End .control-group -->
													<div class="control-group">
														<label class="control-label" for="nodes">Unresolved nodes</label>
														<div class="controls">
															<h:selectOneMenu id="nodes">
																<f:selectItem itemValue="root" itemLabel="Redirect to root" />
															</h:selectOneMenu>
														</div>
													</div><!-- End .control-group -->
												</div>
											</fieldset>
											<div class="form-actions">
												<button class="btn" type="submit">Cancel</button>
												<button class="btn btn-primary disabled" type="submit">Save changes</button>
					        				</div><!-- End .form-actions -->
										</h:form><!-- End .form-horizontal -->
									</td>
								</tr>
							</tbody>
						</table>
					</b:tab>
				</c:forEach>
				</b:tabbable>
			</c:otherwise>
		</c:choose>

        <!-- Injected elements -->

        <div class="alert-container hidden-element">
            <div class="alert alert-success">
                <button data-dismiss="alert" class="close">Close</button>
                <strong>Well done!</strong> The redirect has been successfully deleted.
            </div><!-- End .alert -->
        </div>

        <div class="modal confirmation hide" id="modal-delete-site-space">
            <div class="modal-header">
                <button data-dismiss="modal" class="close" type="button">Close</button>				
                <h3>Delete Site</h3>
            </div>
            <div class="modal-body">
                <p>
                    <strong>Are you sure you want to permanently delete this site?</strong>
                    <span>You can't undo this action.</span>
                </p>
            </div><!-- End .modal-body -->
            <div class="modal-footer">
                <a href="#" class="btn">Cancel</a>
                <a href="#" class="btn btn-primary">Delete this site</a>
            </div>
        </div><!-- end .modal -->

        <div class="modal confirmation hide" id="modal-delete-redirect">
            <div class="modal-header">
                <button data-dismiss="modal" class="close" type="button">Close</button>				
                <h3>Delete Redirect</h3>
            </div>
            <div class="modal-body">
                <p>
                    <strong>Are you sure you want to permanently delete this redirect?</strong>
                    <span>You can't undo this action.</span>
                </p>
            </div><!-- End .modal-body -->
            <div class="modal-footer">
                <a href="#" class="btn">Cancel</a>
                <a href="#" class="btn btn-primary">Delete this redirect</a>
            </div>
        </div><!-- end .modal -->

        <div class="modal confirmation hide" id="modal-condition">
            <div class="modal-header">
                <button class="close" data-dismiss="modal">Close</button>
                <h3>Add Condition</h3>
            </div>
            <div class="modal-body">
                <p class="subtitle">All fields are required</p>
                <div class="control-group">
                    <label class="control-label" for="name2">Condition Name </label>
                    <input type="text" class="input-large" id="name2" />
                </div><!-- End .control-group -->
                <div class="control-group">
                    <table class="table table-striped" id="condition-string">
                        <thead>
                            <tr>
                                <th>User Agent String</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <label>Contains</label>
                                    <div class="condition">
                                        <input type="text" />
                                        <div class="action">
                                            <button class="tooltipTrigger" title="Delete String"><i class="icon-trash">Delete User Agent String</i></button>
                                        </div>
                                    </div>
                                    <div>
                                        <span class="td-condition">OR</span>
                                        <input type="text" />
                                        <div>
                                            <button class="add-user-agent-string tooltipTrigger" title="Add String"><i class="icon-plus-sign">Add User Agent String</i></button>
                                            <button class="tooltipTrigger" title="Delete String"><i class="icon-trash">Delete User Agent String</i></button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <label>Does not contain</label>
                                    <div class="condition">
                                        <input type="text" />
                                        <div class="action">
                                            <button class="tooltipTrigger" title="Delete String"><i class="icon-trash">Delete User Agent String</i></button>
                                        </div>
                                    </div>
                                    <div>
                                        <span class="td-condition">OR</span>
                                        <input type="text" />
                                        <div>
                                            <button class="add-user-agent-string tooltipTrigger" title="Add String"><i class="icon-plus-sign">Add User Agent String</i></button>
                                            <button class="tooltipTrigger" title="Delete String"><i class="icon-trash">Delete User Agent String</i></button>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div><!-- End .control-group -->

                <div class="control-group">	
                    <a class="btn btn-mini pull-right">Add Property</a>
                    <table class="table table-striped button-mini" id="condition-properties">
                        <thead>
                            <tr>
                                <th>Property</th>
                                <th class="hidden-element actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="condition">
                                    <input type="text" class="property" />
                                    <select class="attribute">
                                        <option>Greater than</option>		
                                        <option>Less than</option>		
                                        <option selected="true">Between</option>		
                                        <option>Equals</option>		
                                        <option>Matches</option>
                                    </select>
                                    <div class="input-append-inline">
                                        <input type="text" />
                                        <span>px</span>
                                    </div> and
                                    <div class="input-append-inline">
                                        <input type="text" />
                                        <span>px</span>
                                    </div>
                                </td>
                                <td class="actions">
                                    <a href="#" class="tooltipTrigger" title="Delete Condition"><i class="icon-trash">Delete</i></a>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <span class="td-condition">AND</span>
                                    <input type="text" class="property" />
                                    <select class="attribute">
                                        <option>Greater than</option>		
                                        <option selected="true">Less than</option>		
                                        <option>Between</option>		
                                        <option>Equals</option>		
                                        <option>Matches</option>		
                                    </select>
                                    <div class="input-append-inline">
                                        <input type="text" />
                                        <span>px</span>
                                    </div> 
                                </td>
                                <td class="actions">
                                    <a href="#" class="tooltipTrigger" title="Delete Condition"><i class="icon-trash">Delete</i></a>
                                </td>
                            </tr>
                        </tbody>
                    </table>							
                </div><!-- End .control-group -->
            </div><!-- End .modal-body -->
            <div class="modal-footer">
                <a href="#" class="btn">Cancel</a>
                <a href="#" class="btn btn-primary disabled">Save Condition</a>
            </div>
        </div><!-- end .modal -->

        <div class="modal hide" id="modal-select-node">
            <div class="modal-header">
                <button data-dismiss="modal" class="close" type="button">Close</button>				
                <h3>Select Node - Olympics Site</h3>
            </div>
            <div class="modal-body">
                <div class="window-list">
                    <ul class="clearfix">
                        <li><label for="customers"><input type="radio" id="customers" name="user-group" checked="checked" />/customers</label></li>
                        <li><label for="organization"><input type="radio" id="organization" name="user-group" />/organization</label></li>
                        <li><label for="communication" ><input type="radio" id="communication" name="user-group" />/organization/communication</label></li>
                        <li><label for="marketing"><input type="radio" id="marketing" name="user-group" />/organization/communication/marketing</label></li>
                        <li><label for="press-and-media"><input type="radio" id="press-and-media" name="user-group" />/organization/communication/press-and-media</label></li>
                        <li><label for="management"><input type="radio" id="management" name="user-group" />/organization/management</label></li>
                        <li><label for="executive-board"><input type="radio" id="executive-board" name="user-group" />/organization/management/executive-board</label></li>
                        <li><label for="human-resources"><input type="radio" id="human-resources" name="user-group" />/organization/management/human-resources</label></li>
                        <li><label for="operations"><input type="radio" id="operations" name="user-group" />/organization/operations/operations</label></li>
                        <li><label for="finances"><input type="radio" id="finances" name="user-group" />/organization/operations/finances</label></li>
                        <li><label for="sales"><input type="radio" id="sales" name="user-group" />/organization/operations/sales</label></li>
                        <li><label for="partners"><input type="radio" id="partners" name="user-group" />/organization/operations/partners</label></li>
                        <li><label for="administrators"><input type="radio" id="administrators" name="user-group" />/organization/operations/administrators</label></li>
                        <li><label for="guests"><input type="radio" id="guests" name="user-group" />/organization/operations/guests</label></li>
                        <li><label for="users"><input type="radio" id="users" name="user-group" />/organization/operations/users</label></li>
                        <li><label for="employees"><input type="radio" id="employees" name="user-group" />/organization/operations/employees</label></li>
                        <li><label for="managers"><input type="radio" id="managers" name="user-group" />/organization/operations/managers</label></li>
                        <li><label for="design"><input type="radio" id="design" name="user-group" />/organization/operations/design</label></li>
                    </ul>
                </div><!-- End .windowList -->
            </div><!-- End .modal-body -->
            <div class="modal-footer">
                <a href="#" class="btn">Cancel</a>
                <a href="#" class="btn btn-primary">Select this node</a>
            </div>
        </div><!-- end .modal -->

    </ui:define>
</ui:composition>